%Pakete;
%A4, Report, 12pt
\documentclass[ngerman,a4paper,12pt]{scrreprt}
\usepackage[a4paper, right=20mm, left=20mm,top=30mm, bottom=30mm, marginparsep=5mm, marginparwidth=5mm, headheight=7mm, headsep=15mm,footskip=15mm]{geometry}

%Papierausrichtungen
\usepackage{pdflscape}
\usepackage{lscape}

%Deutsche Umlaute, Schriftart, Deutsche Bezeichnungen
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[ngerman]{babel}

%quellcode
\usepackage{listings}
\usepackage{verbatim}
\usepackage{moreverb}
\let\verbatiminput=\verbatimtabinput
\def\verbatimtabsize{4\relax} 

%tabellen
\usepackage{tabularx}

%listen und aufzählungen
\usepackage{paralist}

%farben
\usepackage[svgnames,table,hyperref]{xcolor}

%symbole
\usepackage{latexsym,textcomp}
\usepackage{amssymb}

%font
\usepackage{helvet}
\renewcommand{\familydefault}{\sfdefault}

%durch- und unterstreichen
\usepackage{ulem}

%Abkürzungsverzeichnisse
\usepackage[printonlyused]{acronym}

%Bilder
\usepackage{graphicx} %Bilder
\usepackage{float}	  %"Floating" Objects, Bilder, Tabellen...
\usepackage[space]{grffile} %Leerzechen Problem bei includegraphics
\usepackage{wallpaper} %Seitenhintergrund setzen
\usepackage{transparent} %Transparenz

%Tikz, Mindmaps, Trees
\usepackage{tikz}
\usetikzlibrary{mindmap,trees}
\usepackage{verbatim}

%for
\usepackage{forloop}
\usepackage{ifthen}

%Dokumenteigenschaften
\title{Summary Dbs2}
\author{Tobias Blaser}
\date{\today{}, Uster}


%Kopf- /Fusszeile
\usepackage{fancyhdr}
\usepackage{lastpage}

\pagestyle{fancy}
	\fancyhf{} %alle Kopf- und Fußzeilenfelder bereinigen
	\renewcommand{\headrulewidth}{0pt} %obere Trennlinie
	\fancyfoot[L]{\jobname} %Fusszeile links
	\fancyfoot[C]{Seite \thepage/\pageref{LastPage}} %Fusszeile mitte
	\fancyfoot[R]{\today{}} %Fusszeile rechts
	\renewcommand{\footrulewidth}{0.4pt} %untere Trennlinie

%Kopf-/ Fusszeile auf chapter page
\fancypagestyle{plain} {
	\fancyhf{} %alle Kopf- und Fußzeilenfelder bereinigen
	\renewcommand{\headrulewidth}{0pt} %obere Trennlinie
	\fancyfoot[L]{\jobname} %Fusszeile links
	\fancyfoot[C]{Seite \thepage/\pageref{LastPage}} %Fusszeile mitte
	\fancyfoot[R]{\today{}} %Fusszeile rechts
	\renewcommand{\footrulewidth}{0.4pt} %untere Trennlinie
}

\usepackage{changepage}

% Abkürzungen für Kapitel, Titel und Listen
\input{commands/shortcutsListAndChapter}
\input{commands/TextStructuringBoxes}

%links, verlinktes Inhaltsverzeichnis, PDF Inhaltsverzeichnis
\usepackage[bookmarks=true,
bookmarksopen=true,
bookmarksnumbered=true,
breaklinks=true,
colorlinks=true,
linkcolor=black,
anchorcolor=black,
citecolor=black,
filecolor=black,
menucolor=black,
pagecolor=black,
urlcolor=black
]{hyperref} % Paket muss unbedingt als letzes eingebunden werden!

\usepackage{graphicx}
\begin{document}

% Inhaltsverzeichnis
\tableofcontents
\clearpage

\ch{Repetition Dbs1}

\exam{'group by' wichtig}
\definition{OLTP}{Online-Transaction-Processing}

\se{ANSI Modell}
\img{img/v1.1.jpg}{ANSI 3-Ebenen Modell}{1}{}

\se{ACID}
\ul
	\li Atomizität: Eine Transaktion ist atomare Verarbeitungseinheit, die entweder vollständig oder gar
nicht ausgeführt wird.
	\li Consistency (Konsistenz): konsistenzerhaltend 
	\li Isolation: Eine T. soll so ausgeführt werden, als sei sie
isoliert von anderen
	\li Durability (Dauerhaftigkeit): Änderungen einer T.
sind dauerhaft, sie dürfen nicht aufgrund von Fehlern
verloren gehen
\ulE

\ch{Oracle's PL/SQL}
\expl{PL/SQL}{SQL ist deklarativ und beschreibt nur was, nicht wie. \textbf{Procedural Language} ermöglicht das wie.}

\img{img/v1.2.jpg}{}{0.75}{}
\ul
	\li wird kompiliert
	\li wird nahe bei den Daten im DD abgelegt
	\li Innerhalb von PL/SQL darf SQL ausgeführt werden, Resultate landen in Variablen
\ulE

\img{img/v1.3.jpg}{}{0.75}{}
\ul
	\li 'DECLARE'-Block optional
	\li Server soll Output zurückschicken: 'SQL> SET SERVEROUTPUT ON'
	\li Letzter Fehler anzeigen: 
	\li PL/SQL Blöcke müssen mit Slash abgeschlossen werden:
		\begin{verbatim}
		SQL> BEGIN
		dbms_output.put_line('Welcome to PL/SQL');
		END;
		/
		\end{verbatim}
	\li SQL> EXEC 'welcome' führt die Funktion welcome aus:
		\begin{verbatim}
		CREATE OR REPLACE PROCEDURE welcome
		IS
		user_name VARCHAR2(8) := user;
		BEGIN -- 'BEGIN'
		dbms_output.put_line('Welcome to
		PL/SQL, ' || user_name || '!');
		END;
		/
		\end{verbatim}
	\li Blöcke dürfen verschachtelt werden: im BEGIN Block dürfen wiederum DECLARE, BEGIN, End, ... Blöcke stehen.
	\li Verschachtelte Blöcke schränken Sichtbarkeit ein
	\li Resultate werden durch 'INTO varname' in Variablen gespeichert
	\li Datentyp von Tabelle übernehmen: ' Tabelle.Spalte\%TYPE;'
	\li Systemvariablen: USER, ...
	\li Exceptions:
		\begin{verbatim}
		WHEN NO_DATA_FOUND THEN
		/*System Exception:
		SELECT INTO liefert keinen Wert*/
		RAISE;
		WHEN TOO_MANY_ROWS THEN
		/*SELECT INTO* liefert mehr als einen Wert*/
		RAISE;
		WHEN DUP_VAL_ON_INDEX THEN
		/*Projektzuteilung existiert bereits*/
		\end{verbatim}
\ulE

\img{img/v1.4.jpg}{PL/SQL Block mit DECLARE, BEGIN EXCEPTION und END Block}{0.75}{}

\se{Exceptions}
Wie in Java.
\img{img/v1.5.jpg}{}{0.75}{}
\img{img/v1.6.jpg}{Benannte Benutzer AUsnahmen}{0.75}{}

\se{Stored Procedures}
\expl{SP}{DBS Subroutine}
\ul
	\li Objekte wie Tabellen, die Rechte und User zugeteilt werden
\ulE

\img{img/v1.7.jpg}{}{0.75}{}

\se{Funktionen}
\expl{Unterschied Procedure und Funktionen}{Funktionen können im SQL verwendet werden (Bps. AVG), Procedures können nur alleine ausgeführt werden.}

\important{Procedure kann nur im PL/SQL aufgerufen werden, Funktion sowohl im SQL wie PL/SQL}

\img{img/v1.8.jpg}{Vergleich}{0.75}{}

\ch{Stored Procedure in PL/SQL, Java und Python}
\ul
	\li SP werden als Block in der Datenbank abgelegt. 
	\li Im Gegensatz zum anon. Block wird die P beim Aufruf geparst und in der DB gespeichert.
	\li Vorteile: Performance, Security (Zentrale Überprüfungen, Zugriffsschutz)
	\li Nachteil: SP herstellerspezifisch, Probleme mit Optimierer
\ulE

\examp{Security}{Security: zum Lesen: Views, zum Schreiben: brauchen keine schreibrechte, nur ausführungsrechte auf Procedure. Procedure definiert genau, was übergeben werden soll und erlaubt nur dies.}

\exam{Prüfungsrelevant: \\
	1. Variablen (DECLARE), Blöcke (BEGIN...END), Konst.
	(CONSTANT) \\
	2. Typen (SQL; \%TYPE; NUMBER, SUBTYPE) \\
	3. Conditional Control Statements (IF...END IF; ) \\
	4. Sequential Control Statements (GOTO, NULL) \\
	5. Loops (LOOP, FOR...LOOP, WHILE...LOOP) \\
	6. Exception Handlers (EXCEPTION, RAISE, \\
	7. Built-In Functions: Character; Date; Numeric, LOB, and
	Miscellaneous Fns., Conversion Fns. \\
	8. Prozeduren und Funktionen (CREATE PROCEDURE...AS) \\
	9. Packages (CREATE PACKAGE; CREATE PACKAGE...BODY ) \\
	10. Cursors (FOR record\_index IN cursor\_name LOOP) \\
	11. Record Types (TYPE first\_rectype IS RECORD (var1
	VARCHAR2(100)), \%ROWTYPE)
}


\ch{IO}
\ul
	\li SET ist nicht Teil von SQL, sondern SQL plus (pakage).
	\li Output: DBMS\_OUTPUT.PUT\_LINE (Putline ist wie eine Pipe, hat nichts mit der Konsole zu tun \ra schreibt in Buffer) \\ Wichtig: SET SERVEROUTPUT ON
	\li Input: DBMS\_OUTPUT.GET\_LINE(:buffer, :status); \\ Wichtig: set echo on;
\ulE


\ch{Packages}
\ul
	\li Gruppieren PL/SQL Typen und Unterprogramme
	\li  Können nicht aufgerufen, parameterized, oder verschachtelt werden
	\li Bsp:dbms\_output, user\_lock
 \ulE
 
 \se{Package Deploying}
 \img{img/v2.1.jpg}{}{0.75}{}
 \img{img/v2.2.jpg}{}{0.75}{}

\sse{Bsp1}
\begin{verbatim}
CREATE OR REPLACE PACKAGE AngestelltenVerwaltung AS
...
FUNCTION AngEinstellen (Name VARCHAR2,..
..
END AngestelltenVerwaltung;

\end{verbatim}

\sse{Bsp2}
\begin{verbatim}
CREATE OR REPLACE PACKAGE BODY AngestelltenVerwaltung AS
...
	PROCEDURE GetAngOfAbt ( AbtNo IN NUMBER,
		..
		IS
		BEGIN
		...
	END GetAngOfAbt;
	...
END AngestelltenVerwaltung;

\end{verbatim}


\ch{Cursor}
\img{img/v2.3.jpg}{Cursor Verarbeitung}{0.75}{}
\img{img/v2.4.jpg}{Cursor Prinzip}{0.75}{}
\img{img/v2.5.jpg}{Cursor Variable}{0.75}{}

\sse{Deklaration Bsp}
\begin{verbatim}
DECLARE
CurrAbtNr integer := 1;
CURSOR AngCursor IS
SELECT Salaer, PersNr FROM Angestellter
WHERE Angestellter.AbtNr=CurrAbtNr;
SalSumme NUMBER (8, 2) := 0;
AngSalaer Angestellter.Salaer%TYPE;
AngPersNr Angestellter.PersNr%TYPE;
\end{verbatim}

\sse{Cursor Verarbeitung}
\begin{verbatim}
BEGIN
OPEN AngCursor; /*SQL-Abfrage starten und Resultat in Puffer
speichern*/
LOOP /*Iteration ueber Resulatmenge*/
FETCH AngCursor INTO AngSalaer, AngPersNr;
EXIT WHEN AngCursor%NOTFOUND OR AngCursor%ROWCOUNT>10
SalSumme := SalSumme + AngSalaer;
dbms_output.put_line('Angstellter PersNr: ' || AngPersNr ||
' Salaer: ' || AngSalaer);
END LOOP;
CLOSE AngCursor;
dbms_output.put_line('Salaersumme: ' || SalSumme);
END;

\end{verbatim}

\important{String werden in 'einfach' Hochkommas geschrieben!}

\sse{Cursor mit Parametern}
\begin{verbatim}
DECLARE
CurrAbtNr integer;
CURSOR AngCursor (AbtId IN Abteilung.AbtNr%TYPE) IS
SELECT Salaer, PersNr FROM Angestellter
WHERE Angestellter.AbtNr=AbtId;
SalSumme NUMBER (8, 2) := 0;
AngRec
 AngCursor%ROWTYPE;

\end{verbatim}

\sse{Cursor for Update}
Cursor muss für Update ``angekündigt'' werden.
\img{img/v2.6.jpg}{}{0.75}{}

\sse{Cursor Attribute}
\img{img/v2.7.jpg}{}{0.75}{}

\end{document}
